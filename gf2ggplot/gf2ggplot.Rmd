---
title: "Tutorial"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(ggformula)
library(palmerpenguins)
library(magrittr)
knitr::opts_chunk$set(echo = FALSE)
```


## Introduction

### The `ggformula` and `ggplot` packages

Until now you have used a range of plotting commands to produce scatterplots,
barplots, boxplots etc. that all come from the `ggformula` R package. You may
not have noticed this package, as it is automatically loaded by `bio2020` if
you use it, or by `mosaic`. The `ggformula` package has a very consistent 
syntax, that aligns with most of your data analyses, in that it is:

`gf_plottype(response ~ explanatory variable(s), data = dataset, ...)`

where the `...` are the options. You can read all about using the `ggformula`
package at <http://www.mosaic-web.org/ggformula/articles/pkgdown/ggformula-blog.html>

What you might not be aware of is that `ggformula` actually provides a simple
interface to a much more advanced package called `ggplot2`. The latter has many
powerful features, including creating maps, 3D plots, tree-diagrams, indeed
every sort of graphic you could possibly think of. Hundreds of extensions to
the original `ggplot2` package are now available in R, which allow you to 
produce virtually any plot you could possibly want. You can view a selection of
them at <https://exts.ggplot2.tidyverse.org/gallery/>

Oh, and in case you are wondering why they all seem to have the letters `gg` in
them, it is because they are based on trying to standardise creation of plots
via a "grammar of graphics".

### Excellent resource for `ggplot2` graphics
This website is excellent and I use it regularly to help tweak graphs to exactly
what I want <http://www.cookbook-r.com/Graphs/>

### Transitioning from `ggformula` to `ggplot2`
The first question you might have is **Why do I need to bother learning `ggplot2`?**
Basically, because you might:

* need to create some more complex plots that `ggformula` cannot handle
* you are working with a member of staff (or in your future career) where `ggplot2`
is well understood, whereas `ggformula` is little used outside teaching.

Fortunately, as you already know how to use `ggformula` you will find it very easy
to learn `ggplot2` and this tutorial will teach you the basics.

## Boxplot
We'll begin by creating a simple boxplot using `ggformula` and compare it with
the `ggplot` syntax. One minor area to watch for is that the R library is
called `ggplot2` but the actual function is `ggplot` which is a bit confusing. We
will use the `palmerpenguins` example as it is a large dataset, designed for
teaching data visualisation for biologists, and you looked at it in earlier 
online websites <https://allisonhorst.github.io/palmerpenguins/index.html>

### Boxplot using `ggformula`
Remember, if running this in RStudio rather than in this website, don't forget
to load the `ggformula` and `palmerpenguins` libraries before you begin:

```{r pp_boxplot, exercise=TRUE, message=FALSE, warning=FALSE}
gf_boxplot(body_mass_g ~ species, data = penguins)
```

You will recall that you can tweak the appearance of your `ggformula` graph to
change background theme, legend labels etc. The following uses the `%>%` pipe
command to keep adding extra improvements to the graph. This is from the
`mosaic` package but is automatically loaded by `bio2020` if you use it.

```{r pp_boxplot_tweaked, exercise=TRUE}
gf_boxplot(body_mass_g ~ species, data = penguins) %>% 
  gf_labs(x = "Penguin species", y = "Body mass (g)", caption = "Summary boxplot") %>% 
  gf_theme(theme_classic())

```

Try running this in RStudio. You may notice a cryptic warning about 2 rows being
omitted.

```{r why2rows, echo=FALSE}
question("Why was a warning about 2 missing rows displayed? Hint: try summary(penguins) in the above code box",
  answer("a) This is automatic in boxplots"),
  answer("b) The data in the `penguins` dataset is corrupt"),
  answer("c) There are 2 missing values coded NA in the dataset", correct = TRUE),
  answer("d) A conflict between ggplot2 and ggformula is causing the warning")
)
```

### Boxplot using `ggplot2`
The syntax is a bit more complex, and admittedly confusing, at first. Here is a
simple boxplot:

```{r boxplot_ggplot, exercise=TRUE}
ggplot(penguins, aes(x = species, y = body_mass_g)) +
  geom_boxplot()
```

The output looks the same as before, but there as several "gotcha's" to look out
for:

* The first line is usually:
`ggplot(datasetname, aes(something_about_x_and_y_data))`

The `aes` is short for `aesthetics` and defines what is going to provide the
overall scaffold for your graph. Here we have both x and y axes defined, but
you may sometimes only have a single variable, for example if doing a frequency
histogram.

* The second line give a `geom_` or `geometry`. There are lots of geometries
available, `geom_line`, `geom_point`, `geom_violin` etc. It is optional whethere
you add anything inside the brackets to the `geom_` call.

* The two lines are connected by a `+` symbol and not a conventional `%>%` pipe
symbol. This is very easy to get confused by.

To give you a better understanding of what is going on, let's re-run the above code
but only entering the first line, without the `+` symbol at the end:

```{r aesonly, exercise=TRUE}
ggplot(penguins, aes(x = species, y = body_mass_g))
```

So you can see that a blank canvas, the right size for your data, has been
created by `ggplot`, but it now wants to know what to put into it.

### Axis labels and themes with `ggplot`
These are fairly similar to the `ggformula` syntax, but there are some minor
differences that you need to be alert to. To recreate our earlier graph, with
better horizontal and vertical axis labels, we need:

```{r, finishedggplotbox, exercise=TRUE, exercise.lines = 5}
ggplot(penguins, aes(x = species, y = body_mass_g)) +
  geom_boxplot() +
  xlab("Species") +
  ylab("Body mass (g)") +
  theme_classic()
```


## Plotting individual variables
You will recall that sometimes you want to view a single variable, e.g. its 
frequency histogram or the count of observations. Again using the `penguins` 
dataset, let's compare `ggformula` and `ggplot`. These are shown with the bare
minimum of commands - you can try changing colours, axis labels, title and
themes in your own time.

### Frequency histograms
In `gf_formula` the command is simply:

```{r gf_formula_fhist, exercise=TRUE}
gf_histogram(~body_mass_g, data=penguins)

```

whilst the equivalent in `ggplot2` is:

```{r ggplot_fhist, exercise=TRUE}
ggplot(penguins, aes(x=body_mass_g)) +
  geom_histogram()
```

A message pops up about `bins = 30` which is the default maximum for `geom_histogram`.
Try changing the line to `geom_histogram(binwidth = 100)` to see the difference it makes.

### Density plots
These are smoothed curves to look at your frequency histograms, and can be used 
separately, or overlaid onto the frequency histogram.

In `ggformula` as hopefully you recall, this can be done with:

```{r gf_density, exercise=TRUE}
gf_density(~body_mass_g, data=penguins)

```

Again, the `ggplot2` equivalent is similar:

```{r ggp_density, exercise=TRUE}
ggplot(penguins, aes(x=body_mass_g)) +
  geom_density(fill = "grey")
```

I've added a `fill = "grey"` option. By default in `ggplot` only the line is
displayed. **In your own time**: edit the code to see if you can overlay a 
density plot on top of a frequency plot. Use `%>%` or `+` to link the relevant
functions together for `ggformula` and `ggplot` respectively.

### Simple bar charts
If we want to visualise the number of observations at each island, this again is
easy to do:

```{r gf_bar, exercise=TRUE}
gf_bar(~island, data= penguins)
```

whilst the equivalent for `ggplot2` is:

```{r ggp_bar, exercise=TRUE}
ggplot(penguins, aes(x = island)) +
  geom_bar(stat = "count")
```

You can see that you have to specify the `stat = "count"` option to `geom_bar`.
This is because `ggplot` is a little more sophisticated. You might already have
a dataframe containing the counts, in which case you would issue `stat = "identity"`
instead.